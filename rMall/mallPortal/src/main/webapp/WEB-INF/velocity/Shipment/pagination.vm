#set( $ContextPath = ${request.contextPath} )
<script src="${ContextPath}/js/jquery.js"></script>
<script src="${ContextPath}/js/bootstrap.min.js"></script>
<script src="${ContextPath}/js/bootbox.js"></script>
<script src="${ContextPath}/js/messageTips.js"></script>

<link href="${ContextPath}/css/select2.min.css" rel="stylesheet" />
<script src="${ContextPath}/js/select2.min.js"></script>

<script>
	function showMessage(msg) {
	
		var alert = "新订单{ 订单编号:" + msg.id + ", 下单时间:" + msg.createDate + " }到达, 请及时处理!!!";
		messageTips.show(alert);
	}

	function onModalOK(){
	
		var stationID = $('#dispatch_stationID').val();
		var orderID = $('#dispatch_orderID').val();
		var obj = $.ajax({
			url    : "dispatch.do",
			async  : false,
			data   : {orderID : orderID, stationID : stationID},
			success: function(data){
				if('SUCCESS' == data){
					//alert($('tr[orderid='+ orderID + ']').html());
					$('tr[orderid='+ orderID + ']').remove();
				}
			}
		});
	}

	$(function () {

		messageTips.init({"selector":".bb-alert"});
		
		$(".js-example-basic-single").select2();
		
		$("[data-toggle='popover_ship']").popover({
			html:true,
			title:'配送信息',
			trigger:'hover'
		});
		
		$(".dispatch").click(function(){
			
			var orderID = $(this).parents("tr").attr("orderID");
			$('#myModal #dispatch_orderID').val(orderID);
			$('#myModal').modal();
		});

		$("[data-toggle='confirm']").click(function(){
			var row = $(this).parents("tr").parent();
			var orderID = $(this).parents("tr").attr("orderID");
			bootbox.confirm("取消订单, 是否继续?", function(result) {
				console.log("cancel order{id : " + orderID + ", userResponse : " + result + "}");
				if(true == result){
					$.post('cancel.do', {id : orderID}, function(data){
						if("SUCCESS" == data){
							row.remove();
						}
					});  
				}
			}); 
		});
	});
</script>


<!-- 新订单提示 -->
<div class="bb-alert alert alert-danger" style="display:none;">
	<button type="button" class="close" aria-hidden="true" onclick="messageTips.hide();">&times;</button>
	<span></span><a href="pendingFirst.do">刷新</a>
</div>

<div class="table-responsive">
<table class="table table-condensed table-hover">
	<thead>
		<tr>
			<th>配送单编号</th>
			<th>跑跑小站</th>
			<th>状态</th>
			<th>下单日期</th>
			<th>操作</th>
			<th>产品</th>
			<th>数量</th>
		</tr>
	</thead>
#foreach( $shipment in ${page.dataList})
	<tbody>
	#foreach( $orderItem in ${shipment.details} )
		<tr shipID="${shipment.id}">
			#if( $velocityCount == 1 )
			<td rowspan="$!{shipment.details.size()}"
				data-container="body" data-toggle="popover_ship" data-content="$orderHelper.format($!{shipment})">
				${shipment.id}
			</td>
			<td rowspan="$!{shipment.details.size()}">${shipment.station.name}</td>
			<td rowspan="$!{shipment.details.size()}">${shipment.status}</td>
			<td rowspan="$!{shipment.details.size()}">${shipment.createDate}</td>
			<td rowspan="$!{shipment.details.size()}">
				<button type="button" class="btn btn-small btn-info re-notify disabled">通知</button>
			</td>
			#end
			<td>${orderItem.product.displayName}</td>
			<td>${orderItem.quantity}</td>
		</tr>
	#end
	</tbody>
#end
</table>
</div>

<div class="pagination pagination-right">
	<ul>
		<li><a href="first.do">|<<</a></li>
		<li><a href="page.do?pageNumber=${page.previousPage}"><</a></li>
		<li><a href="page.do?pageNumber=${page.nextPage}">></a></li>
		<li><a href="page.do?pageNumber=${page.totalPage}">>>|</a></li>
		<li><a href="#">第 ${page.currentPage}页 / 共 ${page.totalPage}页</a></li>
	</ul>
</div>
